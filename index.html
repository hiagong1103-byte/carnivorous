<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Carnivorous</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
}

header {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: #111;
}

header img {
  height: 60px;
}

header h1 {
  font-size: 42px;
  margin: 0;
  flex: 1;
}

header input, header select {
  padding: 8px;
  border-radius: 6px;
  border: none;
}

#produtos {
  padding: 20px;
}

.categoria {
  margin-top: 30px;
}

.categoria h2 {
  border-bottom: 2px solid #333;
  padding-bottom: 5px;
}

.produto {
  padding: 12px 0;
  border-bottom: 1px solid #222;
}

.nome {
  font-weight: bold;
  font-size: 16px;
}

.preco {
  margin: 5px 0;
}

.controle {
  margin-top: 8px;
}

.controle button {
  padding: 4px 10px;
  font-size: 16px;
}

.controle span {
  margin: 0 10px;
  font-weight: bold;
}

#botaoCarrinho {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #25d366;
  color: #000;
  padding: 15px;
  border-radius: 50%;
  cursor: pointer;
  text-align: center;
}

#carrinho {
  display: none;
  position: fixed;
  inset: 0;
  background: #000;
  padding: 20px;
  overflow: auto;
}
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <h1>Carnivorous</h1>

  <input id="busca" placeholder="Buscar produto..." onkeyup="filtrarProdutos()">

  <select id="filtroCategoria" onchange="filtrarProdutos()">
    <option value="">Categorias</option>
  </select>
</header>

<div id="produtos"></div>

<div id="botaoCarrinho" onclick="abrirCarrinho()">
  ðŸ›’ <span id="qtdCarrinho">0</span><br>
  <span id="totalCarrinho">R$ 0,00</span>
</div>

<div id="carrinho">
  <h2>Carrinho</h2>
  <div id="listaCarrinho"></div>
  <h3 id="totalFinal"></h3>
  <button onclick="finalizarPedido()">Finalizar no WhatsApp</button>
  <button onclick="fecharCarrinho()">Fechar</button>
</div>

<script>
// ================= PRODUTOS =================
const produtos = [
<script>
// ================= PRODUTOS VIA PLANILHA =================
const PLANILHA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTsqDIhOoTibb56-QuExYbR9PfD1Fbu4y5x1a9k3X5BcLdl3rRA7tGmCQNI_Gn-uAlkYdUr1FtMigyA/pub?output=csv";

let produtos = [];

fetch(PLANILHA_URL)
  .then(res => res.text())
  .then(csv => {
    const linhas = csv.split("\n").filter(l => l.trim() !== "");
    linhas.shift(); // remove cabeÃ§alho

    produtos = linhas.map(linha => {
      const col = linha.split(",");

      return {
        nome: col[0],
        categoria: col[1],
        unidade: col[2],
        preco: parseFloat(
          col[3]
            .replace("R$", "")
            .replace(".", "")
            .replace(",", ".")
        ) || 0
      };
    });

    carregarCategorias();
    renderizarProdutos();
  })
  .catch(err => {
    alert("Erro ao carregar planilha");
    console.error(err);
  });
</script>

];

// ================= VARIÃVEIS =================
const carrinho = {};
const produtosDiv = document.getElementById("produtos");
const carrinhoDiv = document.getElementById("carrinho");

// ================= CATEGORIAS =================
function carregarCategorias() {
  const categorias = [...new Set(produtos.map(p => p.categoria))];
  categorias.forEach(c => {
    filtroCategoria.innerHTML += `<option value="${c}">${c}</option>`;
  });
}

// ================= RENDER =================
function renderizarProdutos(lista = produtos) {
  produtosDiv.innerHTML = "";
  const porCat = {};

  lista.forEach(p => {
    porCat[p.categoria] = porCat[p.categoria] || [];
    porCat[p.categoria].push(p);
  });

  for (const cat in porCat) {
    produtosDiv.innerHTML += `<div class="categoria"><h2>${cat}</h2></div>`;

    porCat[cat].forEach(p => {
      const id = p.nome.replace(/\W/g,'');
      produtosDiv.innerHTML += `
        <div class="produto">
          <div class="nome">${p.nome}</div>
          <div class="preco">R$ ${p.preco.toFixed(2)}</div>
          <div class="controle">
            <button onclick="remover('${p.nome}')">âˆ’</button>
            <span id="qtd-${id}">0</span>
            <button onclick="adicionar('${p.nome}', ${p.preco})">+</button>
          </div>
        </div>
      `;
    });
  }
}

// ================= CARRINHO =================
function adicionar(nome, preco) {
  carrinho[nome] = carrinho[nome] || { nome, preco, qtd: 0 };
  carrinho[nome].qtd++;
  atualizar();
}

function remover(nome) {
  if (!carrinho[nome]) return;
  carrinho[nome].qtd--;
  if (carrinho[nome].qtd <= 0) delete carrinho[nome];
  atualizar();
}

function atualizar() {
  let qtdTotal = 0;
  let total = 0;

  document.querySelectorAll('[id^="qtd-"]').forEach(e => e.innerText = "0");

  for (const i in carrinho) {
    qtdTotal += carrinho[i].qtd;
    total += carrinho[i].qtd * carrinho[i].preco;

    const span = document.getElementById("qtd-" + i.replace(/\W/g,''));
    if (span) span.innerText = carrinho[i].qtd;
  }

  qtdCarrinho.innerText = qtdTotal;
  totalCarrinho.innerText = "R$ " + total.toFixed(2);
}

// ================= VISUALIZAÃ‡ÃƒO =================
function abrirCarrinho() {
  carrinhoDiv.style.display = "block";
  listaCarrinho.innerHTML = "";
  let total = 0;

  for (const i in carrinho) {
    const it = carrinho[i];
    const sub = it.qtd * it.preco;
    total += sub;
    listaCarrinho.innerHTML += `${it.nome} x${it.qtd} = R$ ${sub.toFixed(2)}<br>`;
  }

  totalFinal.innerText = "TOTAL: R$ " + total.toFixed(2);
}

function fecharCarrinho() {
  carrinhoDiv.style.display = "none";
}

// ================= WHATSAPP =================
function finalizarPedido() {
  let tipo = prompt("Entrega ou Retirada?").toLowerCase();
  let entrega = tipo.includes("entrega") || tipo === "1";

  let endereco = "";
  if (entrega) {
    endereco = prompt("Informe o endereÃ§o completo:");
    if (!endereco) return;

    alert(
      "âš ï¸ Aviso:\nCobramos taxa de entrega por KM.\n" +
      "ApÃ³s enviar o pedido no WhatsApp, calcularemos o valor da entrega."
    );
  }

  let pagamento = prompt("Forma de pagamento: DÃ©bito, CrÃ©dito, Vale ou Pix");
  if (!pagamento) return;

  let msg = "ðŸ›’ Pedido Carnivorous%0A%0A";
  let total = 0;

  for (const i in carrinho) {
    let sub = carrinho[i].qtd * carrinho[i].preco;
    total += sub;
    msg += `${i}%0AQtd: ${carrinho[i].qtd}%0ASubtotal: R$ ${sub.toFixed(2)}%0A%0A`;
  }

  msg += `TOTAL: R$ ${total.toFixed(2)}%0A`;

  if (entrega) {
    msg += `ðŸ“ EndereÃ§o: ${endereco}%0A`;
    msg += `âš ï¸ Taxa de entrega serÃ¡ calculada por KM e informada no WhatsApp.%0A`;
  } else {
    msg += "ðŸª Retirada no local%0A";
  }

  msg += `ðŸ’³ Pagamento: ${pagamento}`;

  window.open(`https://wa.me/5511999562721?text=${msg}`);
}

// ================= FILTRO =================
function filtrarProdutos() {
  const t = busca.value.toLowerCase();
  const c = filtroCategoria.value;

  renderizarProdutos(
    produtos.filter(p =>
      p.nome.toLowerCase().includes(t) &&
      (!c || p.categoria === c)
    )
  );
}

// ================= INIT =================
carregarCategorias();
renderizarProdutos();
</script>

</body>
</html>
