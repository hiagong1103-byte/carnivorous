<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Carnivorous</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
}

/* ===== HEADER ===== */
header {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 20px;
  background: #000;
  border-bottom: 2px solid #111;
}

header img.logo {
  height: 70px;
}

header h1 {
  font-size: 42px;
  margin: 0;
  white-space: nowrap;
}

/* imagem da famÃ­lia */
.familia {
  height: 110px;
  object-fit: contain;
  background: #000;
}

/* busca e filtro */
header input, header select {
  padding: 8px;
  border-radius: 6px;
  border: none;
}

/* ===== PRODUTOS ===== */
#produtos { padding: 20px; }

.categoria { margin-top: 30px; }

.categoria h2 {
  border-bottom: 2px solid #333;
  padding-bottom: 5px;
}

.produto {
  padding: 12px 0;
  border-bottom: 1px solid #222;
}

.controle button {
  padding: 4px 12px;
  font-size: 18px;
}

/* ===== CARRINHO ===== */
#botaoCarrinho {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #25d366;
  color: #000;
  padding: 15px;
  border-radius: 14px;
  cursor: pointer;
  font-weight: bold;
  text-align: center;
}

#carrinho {
  display: none;
  position: fixed;
  inset: 0;
  background: #000;
  padding: 20px;
  overflow: auto;
}
</style>
</head>

<body>

<header>
  <img src="logo.png" class="logo" alt="Logo Carnivorous">

  <h1>CARNIVOROUS</h1>

  <!-- IMAGEM DA FAMÃLIA -->
  <img src="assets/familia-carnivorous.png"
       alt="FamÃ­lia Carnivorous"
       class="familia">

  <input id="busca" placeholder="Buscar produto..." onkeyup="filtrarProdutos()">

  <select id="filtroCategoria" onchange="filtrarProdutos()">
    <option value="">Categorias</option>
  </select>
</header>

<div id="produtos"></div>

<div id="botaoCarrinho" onclick="abrirCarrinho()">
ðŸ›’ <span id="qtdCarrinho">0</span><br>
<span id="totalCarrinho">R$ 0,00</span>
</div>

<div id="carrinho">
<h2>Carrinho</h2>
<div id="listaCarrinho"></div>
<h3 id="totalFinal"></h3>
<button onclick="finalizarPedido()">Finalizar no WhatsApp</button>
<button onclick="fecharCarrinho()">Fechar</button>
</div>

<script>
const PLANILHA =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTsqDIhOoTibb56-QuExYbR9PfD1Fbu4y5x1a9k3X5BcLdl3rRA7tGmCQNI_Gn-uAlkYdUr1FtMigyA/pub?output=csv";

const produtosDiv = document.getElementById("produtos");
const carrinhoDiv = document.getElementById("carrinho");

let listaProdutos = [];
const carrinho = {};

function formatarUnidade(unidade) {
  if (!unidade) return "";
  const u = unidade.toLowerCase();
  if (u.includes("kilo") || u.includes("kg")) return "Kg";
  if (u.includes("un")) return "Unidade";
  return unidade;
}

Papa.parse(PLANILHA, {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function(res) {
    listaProdutos = res.data.map(l => ({
      nome: l["DescriÃ§Ã£o do Produto"],
      categoria: l["Categoria"],
      unidade: l["Unidade de Venda"],
      preco: Number(
        String(l["Valor Venda"])
          .replace("R$", "")
          .replace(/\./g, "")
          .replace(",", ".")
      )
    })).filter(p => p.nome && p.categoria && p.preco && p.unidade);

    carregarCategorias();
    renderizarProdutos();
  }
});

function carregarCategorias() {
  const cats = [...new Set(listaProdutos.map(p => p.categoria))];
  filtroCategoria.innerHTML = `<option value="">Categorias</option>`;
  cats.forEach(c => {
    filtroCategoria.innerHTML += `<option value="${c}">${c}</option>`;
  });
}

function renderizarProdutos(lista = listaProdutos) {
  produtosDiv.innerHTML = "";
  const porCat = {};

  lista.forEach(p => {
    porCat[p.categoria] = porCat[p.categoria] || [];
    porCat[p.categoria].push(p);
  });

  for (const cat in porCat) {
    produtosDiv.innerHTML += `<div class="categoria"><h2>${cat}</h2></div>`;

    porCat[cat].forEach(p => {
      const id = p.nome.replace(/\W/g,"");
      produtosDiv.innerHTML += `
        <div class="produto">
          <b>${p.nome}</b><br>
          R$ ${p.preco.toFixed(2)} / ${formatarUnidade(p.unidade)}
          <div class="controle">
            <button onclick="remover('${p.nome}')">âˆ’</button>
            <span id="qtd-${id}">0</span>
            <button onclick="adicionar('${p.nome}', ${p.preco})">+</button>
          </div>
        </div>`;
    });
  }
}

/* carrinho */
function adicionar(nome, preco) {
  carrinho[nome] = carrinho[nome] || { qtd: 0, preco };
  carrinho[nome].qtd++;
  atualizar();
}

function remover(nome) {
  if (!carrinho[nome]) return;
  carrinho[nome].qtd--;
  if (carrinho[nome].qtd <= 0) delete carrinho[nome];
  atualizar();
}

function atualizar() {
  let q = 0, t = 0;
  document.querySelectorAll('[id^="qtd-"]').forEach(e => e.innerText = "0");

  for (const i in carrinho) {
    q += carrinho[i].qtd;
    t += carrinho[i].qtd * carrinho[i].preco;
    const s = document.getElementById("qtd-" + i.replace(/\W/g,""));
    if (s) s.innerText = carrinho[i].qtd;
  }

  qtdCarrinho.innerText = q;
  totalCarrinho.innerText = "R$ " + t.toFixed(2);
}

function abrirCarrinho() { carrinhoDiv.style.display = "block"; }
function fecharCarrinho() { carrinhoDiv.style.display = "none"; }

function filtrarProdutos() {
  const t = busca.value.toLowerCase();
  const c = filtroCategoria.value;
  renderizarProdutos(
    listaProdutos.filter(p =>
      p.nome.toLowerCase().includes(t) &&
      (!c || p.categoria === c)
    )
  );
}
</script>

</body>
</html>
